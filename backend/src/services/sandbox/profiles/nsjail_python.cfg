# nsjail конфігурація для Python 3
# Використовується для безпечного виконання Python коду

name: "python-sandbox"
mode: EXECUTE

# Використовуємо chroot для ізоляції
chroot: "/sandbox/python"

# Обмеження процесів через cgroup
cgroup_pids_max: 1
cgroup_pids_parent: "sandbox"

# Обмеження пам'яті (256 MB)
cgroup_mem_max: 268435456
cgroup_mem_memsw_max: 268435456
cgroup_mem_parent: "sandbox"

# Обмеження CPU (1 core, 100%)
cgroup_cpu_ms_per_sec: 1000
cgroup_cpu_parent: "sandbox"

# Заборона мережі
disable_clone_newnet: true

# Заборона нових namespace
disable_clone_newuser: false
disable_clone_newns: false
disable_clone_newpid: true
disable_clone_newipc: false
disable_clone_newuts: false
disable_clone_newcgroup: false
disable_clone_newtime: false

# Обмеження файлової системи
mount {
  src: "/sandbox/python"
  dst: "/"
  is_bind: true
  rw: false
}
mount {
  src: "tmpfs"
  dst: "/tmp"
  fstype: "tmpfs"
  rw: true
  options: "size=64M,mode=1777"
}

# Заборона доступу до /proc
mount_proc: false

# Обмеження системних викликів (seccomp)
seccomp_string: "~read,write,open,openat,close,mmap,munmap,mprotect,brk,rt_sigaction,rt_sigprocmask,ioctl,access,pipe,select,readv,writev,clone,execve,exit,exit_group,arch_prctl,set_tid_address,set_robust_list,futex,getpid,getppid,getuid,getgid,geteuid,getegid,gettid,getdents64,getcwd,chdir,stat,newfstatat,uname,readlink,getrandom,prlimit64,getrusage,times,clock_gettime,gettimeofday,time,restart_syscall"

# Обмеження користувача (не root)
uidmap: "0 1000 1"
gidmap: "0 1000 1"

# Обмеження часу виконання (wall time)
time_limit: 3

# Обмеження CPU time
rlimit_cpu: 2

# Обмеження розміру виводу
rlimit_fsize: 65536

# Обмеження кількості відкритих файлів
rlimit_nofile: 32

# Обмеження кількості процесів
rlimit_nproc: 1

# Заборона ptrace
rlimit_core: 0

# Логування
log_level: WARNING
log_fd: -1

# Команда для виконання
exec_bin {
  path: "/usr/bin/python3"
  arg: "-u"
  arg: "-"
  env: "PYTHONUNBUFFERED=1"
  env: "PYTHONDONTWRITEBYTECODE=1"
}

