{
  "version": 3,
  "sources": ["../../../src/index.ts"],
  "sourceRoot": "D:\\StudyCod_Web\\ai-service\\cloudflare-ai-worker\\.wrangler\\tmp\\deploy-rD8WZR",
  "sourcesContent": ["/**\r\n * Cloudflare Worker \u0434\u043B\u044F AI-\u0433\u0435\u043D\u0435\u0440\u0430\u0446\u0456\u0457 \u043D\u0430\u0432\u0447\u0430\u043B\u044C\u043D\u043E\u0433\u043E \u043A\u043E\u043D\u0442\u0435\u043D\u0442\u0443\r\n * \r\n * \u0426\u0435\u0439 \u0444\u0430\u0439\u043B - \u043A\u043E\u0434 \u0434\u043B\u044F Cloudflare Worker, \u044F\u043A\u0438\u0439 \u043F\u043E\u0442\u0440\u0456\u0431\u043D\u043E \u0440\u043E\u0437\u0433\u043E\u0440\u043D\u0443\u0442\u0438 \u043E\u043A\u0440\u0435\u043C\u043E \u043D\u0430 Cloudflare Workers.\r\n * \r\n * \u0412\u0418\u041C\u041E\u0413\u0418:\r\n * - CLOUDFLARE_AI_API_TOKEN \u0432 secrets\r\n * - CLOUDFLARE_ACCOUNT_ID \u0432 secrets\r\n * \r\n * \u0420\u041E\u0417\u0413\u041E\u0420\u0422\u0410\u041D\u041D\u042F:\r\n * wrangler deploy\r\n */\r\n\r\nexport interface Env {\r\n  CLOUDFLARE_AI_API_TOKEN: string;\r\n  CLOUDFLARE_ACCOUNT_ID: string;\r\n}\r\n\r\ninterface WorkerRequest {\r\n  mode: string;\r\n  params: {\r\n    prompt: string;\r\n    systemPrompt?: string;\r\n    schema?: object;\r\n    temperature?: number;\r\n    maxTokens?: number;\r\n  };\r\n}\r\n\r\ninterface WorkerResponse {\r\n  content?: string;\r\n  error?: string;\r\n}\r\n\r\n/**\r\n * \u041D\u043E\u0440\u043C\u0430\u043B\u0456\u0437\u0443\u0454 mode \u0434\u043E \u0441\u0442\u0430\u043D\u0434\u0430\u0440\u0442\u043D\u043E\u0433\u043E \u0444\u043E\u0440\u043C\u0430\u0442\u0443 (kebab-case)\r\n * \u041F\u0456\u0434\u0442\u0440\u0438\u043C\u0443\u0454 \u0432\u0441\u0456 \u0432\u0430\u0440\u0456\u0430\u043D\u0442\u0438: snake_case, kebab-case, camelCase\r\n */\r\nfunction normalizeMode(mode: string): string {\r\n  if (!mode || typeof mode !== 'string') {\r\n    return 'generate-text'; // default\r\n  }\r\n\r\n  // \u041F\u0440\u0438\u0432\u043E\u0434\u0438\u043C\u043E \u0434\u043E \u043D\u0438\u0436\u043D\u044C\u043E\u0433\u043E \u0440\u0435\u0433\u0456\u0441\u0442\u0440\u0443\r\n  let normalized = mode.toLowerCase().trim();\r\n\r\n  // \u0417\u0430\u043C\u0456\u043D\u044E\u0454\u043C\u043E \u043F\u0456\u0434\u043A\u0440\u0435\u0441\u043B\u0435\u043D\u043D\u044F \u0442\u0430 \u043F\u0440\u043E\u0431\u0456\u043B\u0438 \u043D\u0430 \u0434\u0435\u0444\u0456\u0441\u0438\r\n  normalized = normalized.replace(/[_\\s]+/g, '-');\r\n\r\n  // \u0412\u0438\u0434\u0430\u043B\u044F\u0454\u043C\u043E \u043F\u043E\u0434\u0432\u0456\u0439\u043D\u0456 \u0434\u0435\u0444\u0456\u0441\u0438\r\n  normalized = normalized.replace(/-+/g, '-');\r\n\r\n  // \u0412\u0438\u0434\u0430\u043B\u044F\u0454\u043C\u043E \u0434\u0435\u0444\u0456\u0441\u0438 \u043D\u0430 \u043F\u043E\u0447\u0430\u0442\u043A\u0443 \u0442\u0430 \u0432 \u043A\u0456\u043D\u0446\u0456\r\n  normalized = normalized.replace(/^-+|-+$/g, '');\r\n\r\n  // \u041C\u0430\u043F\u0456\u043D\u0433 \u0432\u0456\u0434\u043E\u043C\u0438\u0445 \u0432\u0430\u0440\u0456\u0430\u043D\u0442\u0456\u0432 \u0434\u043E \u0441\u0442\u0430\u043D\u0434\u0430\u0440\u0442\u043D\u0438\u0445 \u043D\u0430\u0437\u0432\r\n  const modeMap: Record<string, string> = {\r\n    'generate-task': 'generate-task',\r\n    'generate_task': 'generate-task',\r\n    'generatetask': 'generate-task',\r\n    'generate-task-with-ai': 'generate-task',\r\n    \r\n    'generate-theory': 'generate-theory',\r\n    'generate_theory': 'generate-theory',\r\n    'generatetheory': 'generate-theory',\r\n    'generate-theory-with-ai': 'generate-theory',\r\n    \r\n    'generate-quiz': 'generate-quiz',\r\n    'generate_quiz': 'generate-quiz',\r\n    'generatequiz': 'generate-quiz',\r\n    'generate-quiz-with-ai': 'generate-quiz',\r\n    \r\n    'generate-task-condition': 'generate-task-condition',\r\n    'generate_task_condition': 'generate-task-condition',\r\n    'generatetaskcondition': 'generate-task-condition',\r\n    \r\n    'generate-task-template': 'generate-task-template',\r\n    'generate_task_template': 'generate-task-template',\r\n    'generatetasktemplate': 'generate-task-template',\r\n    \r\n    'generate-test-data': 'generate-test-data',\r\n    'generate_test_data': 'generate-test-data',\r\n    'generatetestdata': 'generate-test-data',\r\n    'generate-test-data-with-ai': 'generate-test-data',\r\n    \r\n    'generate-text': 'generate-text',\r\n    'generate_text': 'generate-text',\r\n    'generatetext': 'generate-text',\r\n    \r\n    'generate-json': 'generate-json',\r\n    'generate_json': 'generate-json',\r\n    'generatejson': 'generate-json',\r\n  };\r\n\r\n  // \u041F\u0435\u0440\u0435\u0432\u0456\u0440\u044F\u0454\u043C\u043E \u043C\u0430\u043F\u0456\u043D\u0433\r\n  if (modeMap[normalized]) {\r\n    return modeMap[normalized];\r\n  }\r\n\r\n  // \u042F\u043A\u0449\u043E \u043D\u0435 \u0437\u043D\u0430\u0439\u0434\u0435\u043D\u043E \u0432 \u043C\u0430\u043F\u0456\u043D\u0433\u0443, \u043F\u043E\u0432\u0435\u0440\u0442\u0430\u0454\u043C\u043E \u043D\u043E\u0440\u043C\u0430\u043B\u0456\u0437\u043E\u0432\u0430\u043D\u0438\u0439 \u0432\u0430\u0440\u0456\u0430\u043D\u0442\r\n  return normalized || 'generate-text';\r\n}\r\n\r\n/**\r\n * \u0412\u0438\u0437\u043D\u0430\u0447\u0430\u0454 \u043E\u043F\u0442\u0438\u043C\u0430\u043B\u044C\u043D\u0438\u0439 max_tokens \u0437\u0430\u043B\u0435\u0436\u043D\u043E \u0432\u0456\u0434 mode\r\n */\r\nfunction getOptimalMaxTokens(mode: string, requestedMaxTokens?: number): number {\r\n  // \u042F\u043A\u0449\u043E \u044F\u0432\u043D\u043E \u0432\u043A\u0430\u0437\u0430\u043D\u043E - \u0432\u0438\u043A\u043E\u0440\u0438\u0441\u0442\u043E\u0432\u0443\u0454\u043C\u043E \u0439\u043E\u0433\u043E\r\n  if (requestedMaxTokens && requestedMaxTokens > 0) {\r\n    return Math.min(requestedMaxTokens, 8192); // \u041C\u0430\u043A\u0441\u0438\u043C\u0443\u043C \u0434\u043B\u044F Cloudflare AI\r\n  }\r\n\r\n  // \u041E\u043F\u0442\u0438\u043C\u0456\u0437\u043E\u0432\u0430\u043D\u0456 \u0437\u043D\u0430\u0447\u0435\u043D\u043D\u044F \u0437\u0430\u043B\u0435\u0436\u043D\u043E \u0432\u0456\u0434 mode\r\n  const modeMaxTokens: Record<string, number> = {\r\n    'generate-task': 4000,\r\n    'generate-theory': 6000,\r\n    'generate-quiz': 3000,\r\n    'generate-task-condition': 2000,\r\n    'generate-task-template': 1000,\r\n    'generate-test-data': 3000,\r\n    'generate-text': 2000,\r\n    'generate-json': 2000,\r\n  };\r\n\r\n  return modeMaxTokens[mode] || 2000;\r\n}\r\n\r\n/**\r\n * Guard \u0432\u0456\u0434 \u043F\u043E\u0440\u043E\u0436\u043D\u0456\u0445 \u0432\u0456\u0434\u043F\u043E\u0432\u0456\u0434\u0435\u0439 AI\r\n */\r\nfunction validateAIResponse(content: string | null | undefined): void {\r\n  if (!content || typeof content !== 'string') {\r\n    throw new Error('Empty AI response');\r\n  }\r\n\r\n  const trimmed = content.trim();\r\n  \r\n  // \u042F\u043A\u0449\u043E \u0432\u0456\u0434\u043F\u043E\u0432\u0456\u0434\u044C \u0437\u0430\u043D\u0430\u0434\u0442\u043E \u043A\u043E\u0440\u043E\u0442\u043A\u0430 (< 10 \u0441\u0438\u043C\u0432\u043E\u043B\u0456\u0432) - \u0432\u0432\u0430\u0436\u0430\u0454\u043C\u043E \u0457\u0457 \u043D\u0435\u0432\u0430\u043B\u0456\u0434\u043D\u043E\u044E\r\n  if (trimmed.length < 10) {\r\n    throw new Error(`AI response too short (${trimmed.length} chars). Minimum 10 characters required.`);\r\n  }\r\n}\r\n\r\n/**\r\n * Strict JSON parse \u0437 \u043A\u043E\u043D\u0442\u0440\u043E\u043B\u044C\u043E\u0432\u0430\u043D\u043E\u044E \u043F\u043E\u043C\u0438\u043B\u043A\u043E\u044E\r\n */\r\nfunction strictJSONParse(content: string): any {\r\n  if (!content || typeof content !== 'string') {\r\n    throw new Error('Cannot parse JSON: content is not a string');\r\n  }\r\n\r\n  let cleaned = content.trim();\r\n\r\n  // \u0412\u0438\u0434\u0430\u043B\u044F\u0454\u043C\u043E markdown code blocks \u044F\u043A\u0449\u043E \u0454\r\n  if (cleaned.includes('```')) {\r\n    const jsonMatch = cleaned.match(/```(?:json)?\\s*(\\{[\\s\\S]*\\}|\\[[\\s\\S]*\\])\\s*```/);\r\n    if (jsonMatch) {\r\n      cleaned = jsonMatch[1];\r\n    } else {\r\n      // \u0421\u043F\u0440\u043E\u0431\u0443\u0454\u043C\u043E \u0437\u043D\u0430\u0439\u0442\u0438 JSON \u0432 \u043C\u0435\u0436\u0430\u0445 \u0431\u043B\u043E\u043A\u0456\u0432\r\n      const startIdx = cleaned.indexOf('{');\r\n      const endIdx = cleaned.lastIndexOf('}');\r\n      if (startIdx !== -1 && endIdx !== -1 && endIdx > startIdx) {\r\n        cleaned = cleaned.substring(startIdx, endIdx + 1);\r\n      } else {\r\n        const startIdxArr = cleaned.indexOf('[');\r\n        const endIdxArr = cleaned.lastIndexOf(']');\r\n        if (startIdxArr !== -1 && endIdxArr !== -1 && endIdxArr > startIdxArr) {\r\n          cleaned = cleaned.substring(startIdxArr, endIdxArr + 1);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  try {\r\n    return JSON.parse(cleaned);\r\n  } catch (parseError: any) {\r\n    throw new Error(`Failed to parse JSON: ${parseError.message}. Content preview: ${cleaned.substring(0, 100)}`);\r\n  }\r\n}\r\n\r\n/**\r\n * \u0412\u0438\u043A\u043B\u0438\u043A\u0430\u0454 Cloudflare AI API\r\n */\r\nasync function callCloudflareAI(\r\n  env: Env,\r\n  prompt: string,\r\n  systemPrompt?: string,\r\n  options: {\r\n    temperature?: number;\r\n    maxTokens?: number;\r\n    schema?: object;\r\n  } = {}\r\n): Promise<string> {\r\n  const accountId = env.CLOUDFLARE_ACCOUNT_ID;\r\n  const apiToken = env.CLOUDFLARE_AI_API_TOKEN;\r\n\r\n  if (!accountId || !apiToken) {\r\n    throw new Error('Cloudflare AI credentials not configured');\r\n  }\r\n\r\n  const url = `https://api.cloudflare.com/client/v4/accounts/${accountId}/ai/run/@cf/meta/llama-3.1-8b-instruct`;\r\n\r\n  const messages: Array<{ role: string; content: string }> = [];\r\n  \r\n  if (systemPrompt) {\r\n    messages.push({ role: 'system', content: systemPrompt });\r\n  }\r\n  \r\n  messages.push({ role: 'user', content: prompt });\r\n\r\n  const requestBody: any = {\r\n    messages,\r\n    temperature: options.temperature ?? 0.7,\r\n    max_tokens: options.maxTokens ?? 2000,\r\n  };\r\n\r\n  // \u0414\u043E\u0434\u0430\u0454\u043C\u043E response_format \u0434\u043B\u044F JSON mode \u044F\u043A\u0449\u043E \u043F\u043E\u0442\u0440\u0456\u0431\u043D\u043E\r\n  if (options.schema) {\r\n    requestBody.response_format = { type: 'json_object' };\r\n  }\r\n\r\n  const response = await fetch(url, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Authorization': `Bearer ${apiToken}`,\r\n      'Content-Type': 'application/json',\r\n    },\r\n    body: JSON.stringify(requestBody),\r\n  });\r\n\r\n  if (!response.ok) {\r\n    const errorText = await response.text();\r\n    throw new Error(`Cloudflare AI API error (${response.status}): ${errorText}`);\r\n  }\r\n\r\n  const data = await response.json() as any;\r\n  \r\n  if (!data.result || !data.result.response) {\r\n    throw new Error('Invalid response from Cloudflare AI API');\r\n  }\r\n\r\n  return data.result.response;\r\n}\r\n\r\nexport default {\r\n  async fetch(request: Request, env: Env): Promise<Response> {\r\n    // CORS headers\r\n    const corsHeaders = {\r\n      'Access-Control-Allow-Origin': '*',\r\n      'Access-Control-Allow-Methods': 'POST, OPTIONS',\r\n      'Access-Control-Allow-Headers': 'Content-Type',\r\n    };\r\n\r\n    if (request.method === 'OPTIONS') {\r\n      return new Response(null, { status: 204, headers: corsHeaders });\r\n    }\r\n\r\n    if (request.method !== 'POST') {\r\n      return new Response(\r\n        JSON.stringify({ error: 'Method not allowed' }),\r\n        { status: 405, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n      );\r\n    }\r\n\r\n    try {\r\n      const body = await request.json() as WorkerRequest;\r\n      \r\n      if (!body.mode || !body.params || !body.params.prompt) {\r\n        return new Response(\r\n          JSON.stringify({ error: 'Invalid request: mode and params.prompt are required' }),\r\n          { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n        );\r\n      }\r\n\r\n      // \u041D\u043E\u0440\u043C\u0430\u043B\u0456\u0437\u0443\u0454\u043C\u043E mode\r\n      const normalizedMode = normalizeMode(body.mode);\r\n      \r\n      // \u041E\u043F\u0442\u0438\u043C\u0456\u0437\u0443\u0454\u043C\u043E max_tokens\r\n      const optimalMaxTokens = getOptimalMaxTokens(normalizedMode, body.params.maxTokens);\r\n\r\n      // \u0412\u0438\u043A\u043B\u0438\u043A\u0430\u0454\u043C\u043E Cloudflare AI\r\n      let aiResponse: string;\r\n      try {\r\n        aiResponse = await callCloudflareAI(\r\n          env,\r\n          body.params.prompt,\r\n          body.params.systemPrompt,\r\n          {\r\n            temperature: body.params.temperature,\r\n            maxTokens: optimalMaxTokens,\r\n            schema: body.params.schema,\r\n          }\r\n        );\r\n      } catch (aiError: any) {\r\n        console.error('[Worker] Cloudflare AI error:', aiError);\r\n        return new Response(\r\n          JSON.stringify({ \r\n            error: `AI generation failed: ${aiError.message || 'Unknown error'}` \r\n          }),\r\n          { status: 502, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n        );\r\n      }\r\n\r\n      // Guard \u0432\u0456\u0434 \u043F\u043E\u0440\u043E\u0436\u043D\u0456\u0445 \u0432\u0456\u0434\u043F\u043E\u0432\u0456\u0434\u0435\u0439\r\n      try {\r\n        validateAIResponse(aiResponse);\r\n      } catch (validationError: any) {\r\n        console.error('[Worker] AI response validation failed:', validationError);\r\n        return new Response(\r\n          JSON.stringify({ \r\n            error: `AI response validation failed: ${validationError.message}` \r\n          }),\r\n          { status: 502, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n        );\r\n      }\r\n\r\n      // \u0414\u043B\u044F JSON mode - strict parse\r\n      if (normalizedMode === 'generate-json' || body.params.schema) {\r\n        try {\r\n          const parsed = strictJSONParse(aiResponse);\r\n          return new Response(\r\n            JSON.stringify({ content: JSON.stringify(parsed) }),\r\n            { status: 200, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n          );\r\n        } catch (parseError: any) {\r\n          console.error('[Worker] JSON parse failed:', parseError);\r\n          return new Response(\r\n            JSON.stringify({ \r\n              error: `JSON parse failed: ${parseError.message}` \r\n            }),\r\n            { status: 502, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n          );\r\n        }\r\n      }\r\n\r\n      // \u0414\u043B\u044F \u0442\u0435\u043A\u0441\u0442\u043E\u0432\u0438\u0445 \u0440\u0435\u0436\u0438\u043C\u0456\u0432 - \u043F\u043E\u0432\u0435\u0440\u0442\u0430\u0454\u043C\u043E \u044F\u043A \u0454\r\n      return new Response(\r\n        JSON.stringify({ content: aiResponse }),\r\n        { status: 200, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n      );\r\n\r\n    } catch (error: any) {\r\n      console.error('[Worker] Unexpected error:', error);\r\n      return new Response(\r\n        JSON.stringify({ \r\n          error: `Internal server error: ${error.message || 'Unknown error'}` \r\n        }),\r\n        { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n      );\r\n    }\r\n  },\r\n};\r\n\r\n"],
  "mappings": "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",
  "names": []
}
